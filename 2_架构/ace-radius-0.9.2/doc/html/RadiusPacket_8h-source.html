<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ace-radius: ace-radius/RadiusPacket.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7-20040704 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>ace-radius/RadiusPacket.h</h1><pre class="fragment"><div>00001 <span class="comment">/*</span>
00002 <span class="comment"> * This source file is part of the ace-radius library.  This code was</span>
00003 <span class="comment"> * written by Alex Agranov in 2004-2009, and is covered by the BSD open source</span>
00004 <span class="comment"> * license. Refer to the accompanying documentation for details on usage and</span>
00005 <span class="comment"> * license.</span>
00006 <span class="comment"> */</span>
00007 
00008 <span class="preprocessor">#ifndef _RADIUSPACKET_H__</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#define _RADIUSPACKET_H__</span>
00010 <span class="preprocessor"></span>
00011 <span class="preprocessor">#include "RadiusAttribute.h"</span>
00012 
00013 
00014 <span class="comment">// Radius packet code values (from RFC2865)</span>
00015 <span class="preprocessor">#define D_PACKET_ACCESS_REQUEST         1</span>
00016 <span class="preprocessor"></span><span class="preprocessor">#define D_PACKET_ACCESS_ACCEPT          2</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#define D_PACKET_ACCESS_REJECT          3</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#define D_PACKET_ACCOUNTING_REQUEST     4</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#define D_PACKET_ACCOUNTING_RESPONSE    5</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#define D_PACKET_ACCESS_CHALLENGE       11</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#define D_PACKET_STATUS_SERVER          12</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define D_PACKET_STATUS_CLIENT          13</span>
00023 <span class="preprocessor"></span>
00024 <span class="preprocessor">#define D_PACKET_MAX_KNOWN_CODE         13</span>
00025 <span class="preprocessor"></span>
00026 
00027 
00028 <span class="comment">// Some global constants (following RFC definitions)</span>
00029 <span class="preprocessor">#define D_RADIUS_PACKET_HEADER_LENGTH 20</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#define D_RADIUS_PACKET_MAX_LENGTH    4096</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#define D_AUTHENTICATOR_LENGTH        16</span>
00032 <span class="preprocessor"></span>
00033 <span class="comment">// Raw data buffer is used for storing the whole RADIUS packet _AND_ secret key</span>
00034 <span class="comment">// (hence it should be D_RADIUS_PACKET_MAX_LENGTH + D_SECRET_MAX_LENGTH)</span>
00035 <span class="preprocessor">#define D_RAW_DATA_LENGTH           4352</span>
00036 <span class="preprocessor"></span>
00037 
00038 <span class="keyword">class </span><a class="code" href="classRadiusSecret.html">RadiusSecret</a>;
00039 <span class="keyword">class </span><a class="code" href="classRadiusClientStack.html">RadiusClientStack</a>;
00040 
<a name="l00051"></a><a class="code" href="classRadiusPacket.html">00051</a> <span class="keyword">class </span><a class="code" href="classRadiusPacket.html">RadiusPacket</a>
00052 {
00053 <span class="keyword">public</span>:
00054 
00056 
00065     <a class="code" href="classRadiusPacket.html#a0">RadiusPacket</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_code, <a class="code" href="classRadiusClientStack.html">RadiusClientStack</a> &amp; p_stack);
00066 
00068 
00076     <a class="code" href="classRadiusPacket.html#a0">RadiusPacket</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_code, <a class="code" href="classRadiusPacket.html">RadiusPacket</a> &amp; p_request);
00077     
00079 
00091     <a class="code" href="classRadiusPacket.html#a0">RadiusPacket</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_code);
00092 
00093 
00095     <a class="code" href="classRadiusPacket.html#a0">RadiusPacket</a>(<span class="keyword">const</span> <a class="code" href="classRadiusPacket.html">RadiusPacket</a> &amp; p_packet);
00096 
00098     <a class="code" href="classRadiusPacket.html#a4">~RadiusPacket</a>();
00099 
00100 
00102 
00105     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="classRadiusPacket.html#a5">getCode</a>(<span class="keywordtype">void</span>);
00106 
00108     <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classRadiusPacket.html#a6">getCodeDescription</a>(<span class="keywordtype">void</span>);
00109 
00110     
00112 
00115     uint16_t <a class="code" href="classRadiusPacket.html#a7">getLength</a>(<span class="keywordtype">void</span>);
00116 
00117 
00118 
00120 
00123     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="classRadiusPacket.html#a8">getID</a>(<span class="keywordtype">void</span>);
00124     
00126 
00129     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#a9">setID</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_id);
00130 
00132     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#a10">randomID</a>();
00133 
00134 
00136 
00139     <a class="code" href="classRadiusSecret.html">RadiusSecret</a> * <a class="code" href="classRadiusPacket.html#a11">getSecret</a>(<span class="keywordtype">void</span>);
00140     
00142 
00145     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#a12">setSecret</a>(<a class="code" href="classRadiusSecret.html">RadiusSecret</a> * p_secret);
00146 
00147 
00149     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="classRadiusPacket.html#a13">getAuthenticator</a>(<span class="keywordtype">void</span>);
00150     
00152     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#a14">setAuthenticator</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * p_auth);
00153 
00154     
00155 
00157     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#a15">dump</a>();
00158     
00159     
00161 
00182     <span class="keywordtype">int</span> <a class="code" href="classRadiusPacket.html#a16">getFirstAttribute</a>(<a class="code" href="classRadiusAttribute.html">RadiusAttribute</a> &amp; p_attr);
00183 
00184 
00186 
00197     <span class="keywordtype">int</span> <a class="code" href="classRadiusPacket.html#a17">getNextAttribute</a>(<a class="code" href="classRadiusAttribute.html">RadiusAttribute</a> &amp; p_attr);
00198 
00199 
00201 
00213     <span class="keywordtype">int</span> <a class="code" href="classRadiusPacket.html#a18">findAttribute</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_attrType, <a class="code" href="classRadiusAttribute.html">RadiusAttribute</a> &amp; p_attr);
00214 
00215 
00217 
00234     <span class="keywordtype">int</span> <a class="code" href="classRadiusPacket.html#a19">addAttribute</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_attrType, <a class="code" href="classRadiusAttribute.html">RadiusAttribute</a> &amp; p_attr);
00235 
00236     
00238     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * <a class="code" href="classRadiusPacket.html#a20">getRawData</a>(<span class="keywordtype">void</span>);
00239 
00240 
00242 
00249     <span class="keywordtype">int</span> <a class="code" href="classRadiusPacket.html#a21">adjustLength</a>(uint16_t p_length);
00250 
00251 
00253 
00261     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#a22">responseAuthenticator</a>(<a class="code" href="classRadiusSecret.html">RadiusSecret</a> * p_secret = NULL);
00262 
00263 
00264     <span class="comment">// Encode User-Password attribute</span>
00265     <span class="comment">/*</span>
00266 <span class="comment">     * When packet is retransmitted through new connection, there may be a need to reencode</span>
00267 <span class="comment">     * User-Password attribute, since secret key of the new connection may be different.</span>
00268 <span class="comment">     * That's exacly what this method does - reencodes User-Password attribute, if the</span>
00269 <span class="comment">     * latter exists in this packet.</span>
00270 <span class="comment">     *</span>
00271 <span class="comment">     * RadiusClientConnection class uses this method. </span>
00272 <span class="comment">     * There seems to be no reason why user application would use this API.</span>
00273 <span class="comment">     */</span>
00274     <span class="keywordtype">void</span> encodeUserPassword(<span class="keywordtype">void</span>);
00275 
00276 
00278 
00286     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#a24">accountingRequestAuthenticator</a>(<a class="code" href="classRadiusSecret.html">RadiusSecret</a> * p_secret = NULL);
00287 
00288 
00290     <span class="keywordtype">bool</span> <a class="code" href="classRadiusPacket.html#a25">verifyResponse</a>(<a class="code" href="classRadiusPacket.html">RadiusPacket</a> &amp; p_packet);
00291 
00292 <span class="keyword">private</span>:
00293 
00294     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classRadiusAttribute.html">RadiusAttribute</a>;
00295 
00297     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#d0">init</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_code);
00298 
00300     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#d1">randomAuthenticator</a>(<span class="keywordtype">void</span>);
00301 
00302     
00304 
00311     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#d2">setCode</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> p_code);
00312 
00313     
00315 
00320     <span class="keywordtype">void</span> <a class="code" href="classRadiusPacket.html#d3">setLength</a>(uint16_t p_length);
00321 
00322 
00323 
<a name="l00325"></a><a class="code" href="classRadiusPacket.html#r0">00325</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="classRadiusPacket.html#r0">m_data</a>[D_RAW_DATA_LENGTH];
00326 
00327 
<a name="l00329"></a><a class="code" href="classRadiusPacket.html#r1">00329</a>     <a class="code" href="classRadiusSecret.html">RadiusSecret</a> * <a class="code" href="classRadiusPacket.html#r1">m_secret</a>;
00330 
00331 
00332     <span class="comment">// User-Password attribute in unencrypted format</span>
00333     <span class="comment">/*</span>
00334 <span class="comment">     * We need this data in order to re-encode User-Password attribute prior to retransmitting it</span>
00335 <span class="comment">     * through another connection (when more than one RadiusClientConnection is defined);</span>
00336 <span class="comment">     */</span>
00337     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> m_password[D_USER_PASSWORD_MAX_LENGTH];
00338     uint16_t    m_passwordLength;
00339     uint16_t    m_passwordOffset;
00340 
00341     <span class="comment">// Old-Password attribute in unencrypted format</span>
00342     <span class="comment">/*</span>
00343 <span class="comment">     * We need this data in order to re-encode Old-Password attribute prior to retransmitting it</span>
00344 <span class="comment">     * through another connection (when more than one RadiusClientConnection is defined);</span>
00345 <span class="comment">     */</span>
00346     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> m_oldPassword[D_USER_PASSWORD_MAX_LENGTH];
00347     uint16_t    m_oldPasswordLength;
00348     uint16_t    m_oldPasswordOffset;
00349 };
00350 
00351 <span class="preprocessor">#endif // _RADIUSPACKET_H__</span>
00352 <span class="preprocessor"></span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Tue Aug 11 18:35:06 2009 for ace-radius by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7-20040704 </small></address>
</body>
</html>
